;---------------------------------------------------------------
;InitTitleIRQ
;Inicializa la IRQ para dibujar el t√≠tulo en pantalla
;--------------------------------------------------------------- 
InitTitleIRQ  
          jsr WaitFrame
          sei

          lda #$37 ; make sure that IO regs at $dxxx
          sta $01 ;are visible

          lda #$7f ;disable cia #1 generating timer irqs
          sta $dc0d ;which are used by the system to flash cursor, etc

          lda #$01 ;tell VIC we want him generate raster irqs
          sta $d01a

          ;lda #$10 ;nr of rasterline we want our irq occur at
          lda #16
          sta $d012

          lda #$1b ;MSB of d011 is the MSB of the requested rasterline
          sta $d011 ;as rastercounter goes from 0-312

          ;set irq vector to point to our routine
          lda #<IrqSetTextMode
          sta $0314
          lda #>IrqSetTextMode
          sta $0315

          ;acknowledge any pending cia timer interrupts
          ;this is just so we're 100% safe
          lda $dc0d 
          lda $dd0d 

          cli
          rts


;----------------------------------------------------------------------
;IrqSetTextMode
;Configura la parte de la pantalla que tiene el modo texto
;----------------------------------------------------------------------
IrqSetTextMode
          ;acknowledge VIC irq
          lda $d019
          sta $d019

          ;install scroller irq
          lda #<IrqSetBitmapMode
          sta $0314
          lda #>IrqSetBitmapMode
          sta $0315

          ;nr of rasterline we want our irq occur at
          lda #201
          ;lda #190
          sta $d012

          ;disable bitmap mode
          lda #$1b
          sta $D011 

          ;set VIC to bank 3
          lda CIA_PRA
          and #$fc
          sta CIA_PRA

          ;bitmap to lower half, screen char pos at 3 * 1024 ( + 16384)
          lda #%00111110
          sta VIC_MEMORY_CONTROL

          jmp $ea31



;----------------------------------------------------------------------
;IrqSetBitmapMode
;Configura la parte de la pantalla que tiene el bitmap
;----------------------------------------------------------------------
IrqSetBitmapMode
          ;acknowledge VIC irq
          lda $d019
          sta $d019

          ;install top part
          lda #<IrqSetTextMode
          sta $0314
          lda #>IrqSetTextMode
          sta $0315

          ;nr of rasterline we want our irq occur at
          lda #16
          sta $d012

          ;bitmap modus on
          lda $D011
          ora #32
          ;lda #$3b
          sta $D011 

          ;set VIC to bank 0
          lda CIA_PRA
          and #$fc
          ora #$03
          sta CIA_PRA

          ;bitmap to lower half, screen char pos at 3 * 1024 ( + 16384)
          ;lda #%10111000
          lda VIC_MEMORY_CONTROL
          ;ora #8
          lda #$1D
          sta VIC_MEMORY_CONTROL

          JMP $ea31


rellenarBitmapMemory
        lda #0
        ldx #0
ClearLineasBitmapScreenLoop
        sta $3680,x
        sta $3680 + 40,x
        sta $3680 + 80,x
        sta $3680 + 160,x
        inx
        cpx #80
        bne ClearLineasBitmapScreenLoop

        lda #0
        ldx #0
ClearLineasBitmapScreenColorLoop
        sta $0620,x
        inx
        cpx #40
        bne ClearLineasBitmapScreenColorLoop

        rts

ponerQuitarPergamino
        ldx #10
loopPergamino
        sta BITMAP_SCREEN_COLOR+14,x
        sta BITMAP_SCREEN_COLOR+54,x
        sta BITMAP_SCREEN_COLOR+94,x
        sta BITMAP_SCREEN_COLOR+134,x
        dex
        bne loopPergamino

        rts


BITMAP_COLOR_DATA
    BYTE $00,$00,$00,$00,$00,$00,$01,$00,$00,$00,$00,$00,$00,$00,$00,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$05,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00,$07,$07,$77,$77,$77,$77,$77,$77,$07,$07,$00,$00,$00,$00,$00,$00,$01,$01,$00,$01,$01,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$05,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$07,$07,$77,$77,$77,$77,$77,$77,$07,$07,$00,$00,$00,$00,$00,$00,$01,$01,$00,$01,$01,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$05,$05,$05,$05,$01,$01,$01,$00,$00,$00,$00,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$00,$00,$01,$01,$01,$00,$01,$01,$05,$05,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$05,$05,$00,$00,$05,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$05,$05,$05,$00,$05,$05,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$05,$05,$05,$05,$05,$00,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05,$00,$05,$05,$00,$00,$00,$00,$00

*=$3770
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$CF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $FF,$FF,$FC,$F9,$F9,$FD,$FF,$FA,$FF,$FF,$CF,$2A,$35,$6A,$B5,$28,$FF,$FF,$FF,$FF,$D5,$AB,$01,$01,$FF,$FF,$FF,$FF,$D5,$80,$00,$00,$FF,$FF,$FF,$FF,$7F,$B9,$60,$00
    BYTE $FF,$FF,$FF,$FF,$FF,$FF,$8C,$08,$FF,$FF,$FF,$FF,$57,$AA,$05,$00,$FF,$FF,$FF,$FF,$D5,$FB,$5C,$08,$FF,$FF,$D3,$AC,$54,$8E,$0D,$14,$FF,$FF,$3F,$9F,$9F,$DF,$DF,$3F
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$FE,$F8,$F7,$E7
    BYTE $FF,$FC,$FC,$C0,$00,$3C,$FC,$FC,$0F,$0F,$1F,$1F,$1F,$07,$00,$78,$FF,$FF,$FF,$FF,$FF,$FF,$3F,$07,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $FC,$FA,$FC,$FA,$FC,$FA,$FC,$FA,$30,$28,$30,$28,$30,$28,$30,$28,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0C,$14,$0C,$14,$0C,$14,$0C,$14,$5F,$3F,$5F,$3F,$5F,$3F,$5F,$3F
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$FE,$FC,$F0,$F0,$FF,$EF,$CF,$8F,$0F,$0F,$0F,$0F,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$F8,$80,$E0,$F0
    BYTE $FF,$FF,$FF,$FF,$01,$07,$1F,$3F,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$EF,$CF,$CF,$8F,$8F,$87,$87,$87
    BYTE $F8,$F8,$F8,$F8,$F8,$F0,$F0,$F0,$7F,$7F,$7F,$FF,$FF,$FF,$FF,$FF,$C3,$F3,$F9,$F9,$FC,$FC,$FC,$FC,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$8F,$FF,$FF,$FF,$FF,$FF,$FF,$F8,$E0
    BYTE $FF,$FF,$FF,$FF,$FF,$87,$03,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $FC,$FA,$FC,$FA,$FC,$FA,$FC,$FA,$30,$28,$30,$28,$30,$28,$30,$28,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0C,$14,$0C,$14,$0C,$14,$0C,$14,$5F,$3F,$5F,$3F,$5F,$3F,$5F,$3F
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$F0,$F0,$F0,$F0,$F0,$E0,$E0,$E0,$07,$07,$27,$23,$33,$33,$71,$78,$00,$00,$00,$00,$00,$00,$00,$00,$F0,$F0,$F0,$E1,$E1,$E1,$E3,$E3
    BYTE $7F,$7F,$FF,$FF,$FF,$FF,$FF,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$83,$C3,$C1,$C0,$E1,$E3,$F7,$FF
    BYTE $E1,$E1,$E1,$C2,$C2,$C3,$C3,$83,$FF,$FF,$FF,$3F,$00,$00,$80,$FF,$FC,$F8,$F9,$81,$03,$0F,$FF,$FF,$87,$80,$80,$C3,$C3,$C3,$E3,$E1,$80,$02,$1F,$FF,$FF,$FF,$FF,$FF
    BYTE $01,$01,$83,$C7,$FF,$FF,$FF,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $FC,$FA,$FC,$FA,$FD,$FE,$FF,$FF,$34,$2A,$15,$1F,$1F,$FF,$FF,$FF,$00,$AA,$FF,$FF,$FF,$FF,$FF,$FF,$21,$FA,$FF,$FF,$FF,$FF,$FF,$FF,$5D,$AF,$FF,$FF,$FF,$FF,$FF,$FF
    BYTE $53,$AF,$FF,$FF,$FF,$FF,$FF,$FF,$00,$AA,$FF,$FF,$FF,$FF,$FF,$FF,$30,$FA,$FF,$FF,$FF,$FF,$FF,$FF,$2C,$54,$A8,$F8,$F8,$FE,$FF,$FF,$5F,$3F,$5F,$3F,$5F,$3F,$FF,$FF
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$8E,$FF,$FF,$FF,$FF,$F0,$80,$00,$3F,$FF,$FF,$FF,$FF,$FF,$3F,$0F,$0F
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$E0,$E0,$E0,$E0,$E0,$E1,$E1,$C1,$78,$7E,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$7F,$7F,$3F,$3F,$BF,$9F,$9F,$E3,$E3,$C3,$C7,$C7,$C7,$C7,$C7
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FE
    BYTE $87,$87,$87,$07,$0F,$0F,$0F,$0F,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$E1,$E1,$C1,$C1,$C1,$81,$81,$81,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $FF,$FE,$F8,$E0,$C1,$C3,$C3,$87,$9F,$0F,$07,$E3,$E3,$F1,$F1,$F8,$FC,$F0,$FC,$FE,$FE,$FF,$FF,$FF,$0F,$01,$00,$0C,$1F,$1F,$1D,$01,$FF,$FF,$00,$00,$FF,$FF,$FF,$FF
    BYTE $E4,$04,$0C,$7C,$F8,$F8,$F1,$E3,$1F,$07,$03,$63,$71,$F1,$F8,$7C,$80,$F8,$FE,$FF,$FF,$FF,$FF,$FF,$00,$01,$00,$80,$8C,$C7,$C3,$E3,$F8,$FF,$FF,$FE,$7E,$3E,$1E,$8E
    BYTE $01,$07,$0F,$3F,$3E,$3E,$3E,$7F,$8F,$83,$00,$38,$38,$3C,$3E,$1E,$FE,$FE,$FE,$FF,$7F,$7F,$1F,$07,$0F,$03,$00,$30,$3F,$7F,$FF,$FF,$FF,$FF,$0F,$00,$E0,$F8,$F8,$F8
    BYTE $FF,$FC,$80,$01,$3F,$FF,$FF,$FF,$0F,$0F,$1F,$1F,$DF,$FE,$FE,$FE,$8C,$FC,$0C,$0C,$0C,$1E,$1F,$1F,$7F,$7F,$7F,$7F,$3F,$3F,$3F,$3F,$07,$87,$83,$83,$83,$83,$83,$07
    BYTE $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FE,$C1,$C3,$C3,$83,$87,$07,$07,$07,$00,$00,$00,$00,$00,$00,$00,$00,$CF,$CF,$CF,$E7,$E7,$E7,$F3,$F3,$CF,$8F,$8F,$8F,$8F,$1F,$1F,$1F
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FE,$FE,$FE,$FC,$FC,$F0,$E0,$80
    BYTE $07,$07,$07,$01,$00,$00,$00,$00,$FF,$FF,$FF,$FF,$3F,$07,$01,$00,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$7F,$01,$03,$83,$C3,$FF,$FF,$FF,$FF,$00,$00,$00,$00,$00,$00,$00,$00
    BYTE $87,$87,$83,$C0,$C0,$E0,$F0,$FF,$F8,$F0,$F0,$00,$00,$01,$FF,$FF,$FF,$FF,$F8,$E0,$C0,$80,$03,$FF,$01,$19,$1D,$1F,$3F,$FF,$FF,$FF,$FF,$FF,$FF,$FC,$F8,$C0,$FF,$FF
    BYTE $C6,$CC,$0E,$1F,$3F,$1F,$FF,$FF,$60,$00,$1F,$FF,$FF,$FF,$FF,$FF,$3F,$0F,$03,$C0,$F0,$F0,$FF,$FF,$E3,$E1,$E1,$F0,$30,$00,$FF,$FF,$CE,$E6,$E2,$F0,$38,$18,$FF,$FF
    BYTE $7C,$7C,$7C,$38,$38,$30,$FF,$FF,$00,$00,$60,$FF,$7F,$3F,$FF,$FF,$01,$20,$38,$FE,$FF,$FE,$FF,$FF,$FF,$7F,$0F,$01,$00,$00,$FF,$FF,$FC,$FC,$FC,$FE,$7E,$00,$FF,$FF
    BYTE $7F,$7F,$7F,$3F,$03,$00,$FF,$FF,$FE,$FC,$FC,$F8,$F8,$F8,$FF,$FF,$1F,$3F,$3F,$3F,$3F,$7F,$FF,$FF,$87,$C3,$C0,$E0,$F8,$FF,$C0,$FF,$07,$0F,$0F,$0F,$3F,$F0,$00,$FF
    BYTE $FE,$FE,$F8,$E0,$00,$00,$00,$FF,$07,$0F,$0F,$0F,$0F,$1F,$1F,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$F9,$F9,$F8,$FC,$FC,$FC,$FE,$FF,$1F,$1F,$1F,$1F,$1F,$3F,$3F,$FF
    BYTE $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
